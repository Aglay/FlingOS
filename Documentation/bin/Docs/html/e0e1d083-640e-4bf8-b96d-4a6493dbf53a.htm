<html>
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <link rel="shortcut icon" href="../icons/favicon.ico" />
    <link rel="stylesheet" type="text/css" href="../styles/branding.css" />
    <link rel="stylesheet" type="text/css" href="../styles/branding-en-US.css" />
    <script type="text/javascript" src="../scripts/branding.js"> </script>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <title>Kernel Compiler</title>
    <meta name="Language" content="en-us" />
    <meta name="Microsoft.Help.Id" content="e0e1d083-640e-4bf8-b96d-4a6493dbf53a" />
    <meta name="Description" content="An overview of the Kernel Compiler and its architecture are presented below." />
    <meta name="Microsoft.Help.ContentType" content="Concepts" />
    <meta name="BrandingAware" content="true" />
    
    
    <link rel="stylesheet" type="text/css" href="../styles/branding-Website.css" />
    <script type="text/javascript" src="../scripts/jquery-1.11.0.min.js"></script>
    <script type="text/javascript" src="../scripts/branding-Website.js"></script>
  </head>
  <body onload="OnLoad('cs')">
    <input type="hidden" id="userDataCache" class="userDataStyle" />
    <div class="pageHeader" id="PageHeader">Fling OS<form id="SearchForm" method="get" action="#" onsubmit="javascript:TransferToSearchPage(); return false;"><input id="SearchTextBox" type="text" maxlength="200" /><button id="SearchButton" type="submit"></button></form></div>
    <div class="pageBody">
      <div class="leftNav" id="leftNav"><div id="tocNav"><div class="toclevel0" data-toclevel="0"><a class="tocCollapsed" onclick="javascript: Toggle(this);" href="#!"></a><a data-tochassubtree="true" href="dd3e390e-07c0-499b-8f92-2cb8e8ca8b09.htm" title="Fling OS" tocid="roottoc">Fling OS</a></div><div class="toclevel0" data-toclevel="0"><a class="tocCollapsed" onclick="javascript: Toggle(this);" href="#!"></a><a data-tochassubtree="true" href="64d7d98a-eb1c-47ab-8fdf-f2411f237efc.htm" title="Conceptual" tocid="9fc51b1b-401c-420a-aba4-908af87b2815">Conceptual</a></div><div class="toclevel1 current" data-toclevel="1" data-childrenloaded="true"><a class="tocExpanded" onclick="javascript: Toggle(this);" href="#!"></a><a data-tochassubtree="true" href="e0e1d083-640e-4bf8-b96d-4a6493dbf53a.htm" title="Kernel Compiler" tocid="e0e1d083-640e-4bf8-b96d-4a6493dbf53a">Kernel Compiler</a></div><div class="toclevel2" data-toclevel="2"><a data-tochassubtree="false" href="2ab7af0a-7eb4-46c9-85b6-565b3ab7693b.htm" title="Processing Flow Details" tocid="2ab7af0a-7eb4-46c9-85b6-565b3ab7693b">Processing Flow Details</a></div><div class="toclevel2" data-toclevel="2"><a data-tochassubtree="false" href="c6e4fa96-1037-4c8d-b9c5-bfee5405b5b4.htm" title="Using the compiler" tocid="c6e4fa96-1037-4c8d-b9c5-bfee5405b5b4">Using the compiler</a></div></div></div><div id="TocResize" class="tocResize" onmousedown="OnMouseDown(event);"><img id="ResizeImageIncrease" src="../icons/TocOpen.gif" onclick="OnIncreaseToc()" alt="Click or drag to resize" title="Click or drag to resize"><img id="ResizeImageReset" src="../icons/TocClose.gif" style="display:none" onclick="OnResetToc()" alt="Click or drag to resize" title="Click or drag to resize"></div><div class="topicContent" id="TopicContent">
        <table class="titleTable">
          <tr>
            <td class="titleColumn">Kernel Compiler</td>
          </tr>
        </table>
        <span class="introStyle"></span>
        <div class="introduction">
          <p>
        An overview of the Kernel Compiler and its architecture are 
        presented below.
      </p>
        </div>
        <div class="collapsibleAreaRegion" id="GeneralOverview">
          <span class="collapsibleRegionTitle" onclick="SectionExpandCollapse('ID0RB')" onkeypress="SectionExpandCollapse_CheckKey('ID0RB', event)" tabindex="0">
            <img id="ID0RBToggle" class="collapseToggle" src="../icons/SectionExpanded.png" />General Overview</span>
        </div>
        <div id="ID0RBSection" class="collapsibleSection">
          <p>
          The Kernel Compiler is an IL to assembly (ASM) language compiler. The Microsoft MSBuild 
          compiler handles much of the complex compilation from C# to IL. IL language itself is 
          very close to assembly language and so the compilation from IL to ASM is relatively simple. 
          Most of the work comes from:
        </p>
          <ul>
            <li>
              <p>Scanning all the IL code and converting it to ASM</p>
            </li>
            <li>
              <p>Finding methods that are ASM plugged and loading/inserting the ASM plugs </p>
            </li>
            <li>
              <p>Sequencing the ASM into one continuous .ASM (text) file</p>
            </li>
            <li>
              <p>Saving debug information into a .PDB (database) file</p>
            </li>
          </ul>
        </div>
        <div class="collapsibleAreaRegion" id="ProcessingFlowOverview">
          <span class="collapsibleRegionTitle" onclick="SectionExpandCollapse('ID1RB')" onkeypress="SectionExpandCollapse_CheckKey('ID1RB', event)" tabindex="0">
            <img id="ID1RBToggle" class="collapseToggle" src="../icons/SectionExpanded.png" />Processing Flow</span>
        </div>
        <div id="ID1RBSection" class="collapsibleSection">
          <p>
          This section is given in much more detail in <a href="2ab7af0a-7eb4-46c9-85b6-565b3ab7693b.htm">Processing Flow Details</a>.
        </p>
          <p>
            <span class="media">
              <img alt="Fling OS - Kernel Compiler Model 1" src="../media/Fling OS - Kernel Compiler Model 1.png" />
            </span>
          </p>
          <p>
          This model gives a short overview of how the Kernel Compiler should work. Initially, MSBuild converts C# to IL code. The Kernel Compiler then reads in that IL code (IL Reader) into a full list of classes (List of classes) and a list of classes that contain one or more plugged methods (List of plugged classes). These two lists are handed to the IL Scanner. The IL Scanner then loops through:
        </p>
          <ol>
            <li>
              <p>The list of plugged classes</p>
              <ol>
                <li>
                  <p>For each class, loop through all plugged methods</p>
                </li>
                <li>
                  <p>Load the relevant plug ASM file</p>
                </li>
                <li>
                  <p>Create an ASM chunk and add it to the full list of ASM chunks (List of ASM chunks)</p>
                </li>
              </ol>
            </li>
            <li>
              <p>The list of all classes</p>
              <ol>
                <li>
                  <p>For each class, loop through all not-plugged methods</p>
                </li>
                <li>
                  <p>Loop through all the IL ops for each method</p>
                </li>
                <li>
                  <p>Convert the IL ops to ASM</p>
                </li>
                <li>
                  <p>Create an ASM chunk and add it to the full list of ASM chunks (List of ASM 
                chunks)</p>
                </li>
              </ol>
            </li>
          </ol>
          <p>
          N.B. An ASM chunk is essentially a piece of ASM text but may have / require peripheral 
          information.
        </p>
          <p>
          After the full list of ASM chunks has been compiled (List of ASM chunks), each chunk is 
          sequenced into the continuous ASM file and written to the file. By sequencing the chunks, 
          we mean placing them in the correct order. Some chunks, such as the initial boot code, 
          needs to go first. Other chunks may not matter where they go in the file.
        </p>
          <p>
          Finally, once the ASM file has been written, an existing tool, such as NASM, can compile 
          it from ASM into actually binary code and thus into something like a .ISO file which can 
          be run in a virtual machine for testing.
        </p>
          <p>
          One thing missed by this model is the output of debug information. The debug information 
          must contain things like method signatures, stack info, type info, and relation of ASM 
          line to C# line/method etc. However, none of this is central to the compiler so is not 
          included in this model.
        </p>
        </div>
        <div class="collapsibleAreaRegion" id="seeAlsoSection">
          <span class="collapsibleRegionTitle" onclick="SectionExpandCollapse('ID2RB')" onkeypress="SectionExpandCollapse_CheckKey('ID2RB', event)" tabindex="0">
            <img id="ID2RBToggle" class="collapseToggle" src="../icons/SectionExpanded.png" />See Also</span>
        </div>
        <div id="ID2RBSection" class="collapsibleSection">
          <h4 class="subHeading">Other Resources</h4>
          <div class="seeAlsoStyle">
            <a href="2ab7af0a-7eb4-46c9-85b6-565b3ab7693b.htm">Processing Flow Details</a>
          </div>
        </div>
      </div>
    </div>
    <div id="pageFooter" class="pageFooter">
      <p>
        <a href="http://www.flingos.co.uk" target="_blank">Copyright Edward Nutting 2014</a>
      </p>
      <div class="feedbackLink">Send comments on this topic to
        <a id="HT_MailLink" href="mailto:edwardnutting%40outlook.com?Subject=Fling OS">Edward Nutting</a></div>
      <script type="text/javascript">
        var HT_mailLink = document.getElementById("HT_MailLink");
        var HT_mailLinkText = HT_mailLink.innerHTML;
        HT_mailLink.href += ": " + document.title + "\u0026body=" + encodeURIComponent("Your feedback is used to improve the documentation and the product. Your e-mail address will not be used for any other purpose and is disposed of after the issue you report is resolved. While working to resolve the issue that you report, you may be contacted via e-mail to get further details or clarification on the feedback you sent. After the issue you report has been addressed, you may receive an e-mail to let you know that your feedback has been addressed.");
        HT_mailLink.innerHTML = HT_mailLinkText;
        </script>
    </div>
  </body>
</html>